<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart PDF Keyword Extractor</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: linear-gradient(to bottom right, #eef2ff, #e0e7ff);
    }
    .fade {
      animation: fadeIn 0.6s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="min-h-screen">

<div class="max-w-4xl mx-auto py-12 fade">

  <h1 class="text-4xl font-extrabold text-center text-indigo-700 mb-10">
    üìò Smart PDF & Text Keyword Extractor
  </h1>

  <!-- Upload Section -->
  <div class="bg-white shadow-xl rounded-xl p-8 mb-8">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Upload PDF Documents</h2>

    <div id="dropzone"
         class="border-2 border-dashed border-gray-400 rounded-lg p-10 bg-gray-50 text-center cursor-pointer transition hover:border-indigo-400 hover:bg-indigo-50">
      <p class="text-gray-600 text-lg">Drag & drop PDF files here</p>
      <p class="text-gray-400 text-sm">or click to upload</p>
      <input type="file" id="fileInput" accept="application/pdf" multiple class="hidden">
    </div>

    <div id="fileList" class="mt-5 space-y-4"></div>
  </div>

  <!-- Text Input -->
  <div class="bg-white shadow-xl rounded-xl p-8 mb-8">
    <h2 class="text-xl font-semibold text-gray-800 mb-2">Or Paste Custom Text</h2>
    <textarea id="text_input"
              rows="5"
              class="w-full p-4 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-indigo-400"
              placeholder="Write text here for keyword extraction..."></textarea>
  </div>

  <!-- Settings -->
  <div class="bg-white shadow-xl rounded-xl p-8 mb-8">
    <h2 class="text-xl font-semibold text-gray-800 mb-6">Extraction Settings</h2>

    <div class="grid grid-cols-2 gap-6">

      <div>
        <label class="font-semibold">Top Keywords</label>
        <input id="top_k" type="number" value="10"
               class="w-full p-3 border rounded-lg bg-gray-50">
      </div>

      <div>
        <label class="font-semibold">Summary Sentences</label>
        <input id="summary_sentences" type="number" value="3"
               class="w-full p-3 border rounded-lg bg-gray-50">
      </div>

    </div>

    <button id="extractBtn"
            class="mt-6 w-full bg-indigo-600 text-white p-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
      üîç Extract Keywords & Summary
    </button>
  </div>

  <!-- Results -->
  <div id="results" class="fade"></div>

</div>

<script>
  const dropzone = document.getElementById("dropzone");
  const fileInput = document.getElementById("fileInput");
  const fileList = document.getElementById("fileList");
  const extractBtn = document.getElementById("extractBtn");

  let files = [];

  dropzone.onclick = () => fileInput.click();

  dropzone.addEventListener("dragover", e => {
    e.preventDefault();
    dropzone.classList.add("bg-indigo-100", "border-indigo-500");
  });

  dropzone.addEventListener("dragleave", () => {
    dropzone.classList.remove("bg-indigo-100", "border-indigo-500");
  });

  dropzone.addEventListener("drop", e => {
    e.preventDefault();
    dropzone.classList.remove("bg-indigo-100", "border-indigo-500");

    const dropped = Array.from(e.dataTransfer.files).filter(f => f.type === "application/pdf");
    files = [...files, ...dropped];
    renderFiles();
  });

  fileInput.onchange = e => {
    const selected = Array.from(e.target.files);
    files = [...files, ...selected];
    renderFiles();
  };

  function renderFiles() {
    fileList.innerHTML = "";
    files.forEach((file, i) => {
      const div = document.createElement("div");
      div.className =
        "flex justify-between items-center border p-4 rounded-lg bg-gray-50 shadow";

      div.innerHTML = `
        <div class="flex items-center gap-4">
          <span class="text-indigo-600 text-3xl">üìÑ</span>
          <div>
            <p class="font-semibold">${file.name}</p>
            <p class="text-xs text-gray-500">${(file.size / 1024).toFixed(1)} KB</p>
          </div>
        </div>

        <input type="text"
               placeholder="Pages e.g. 1-2,5"
               class="range-input p-2 border rounded w-32 text-sm"
               data-i="${i}">
      `;

      fileList.appendChild(div);
    });
  }


  extractBtn.onclick = async () => {
    extractBtn.disabled = true;
    extractBtn.innerText = "Processing...";

    const formData = new FormData();

    files.forEach(file => formData.append("pdf_file", file));
    formData.append("text_input", document.getElementById("text_input").value);
    formData.append("top_k", document.getElementById("top_k").value);
    formData.append("summary_sentences", document.getElementById("summary_sentences").value);

    const ranges = [];
    document.querySelectorAll(".range-input").forEach(inp => {
      ranges[inp.dataset.i] = inp.value || "";
    });
    formData.append("page_ranges", JSON.stringify(ranges));

    const res = await fetch("/extract", { method: "POST", body: formData });
    const data = await res.json();

    displayResults(data.results);

    extractBtn.innerText = "üîç Extract Keywords & Summary";
    extractBtn.disabled = false;
  };

  function displayResults(results) {
    const container = document.getElementById("results");
    container.innerHTML = "";

    results.forEach(r => {
      const div = document.createElement("div");
      div.className = "bg-white shadow-xl rounded-xl p-8 mb-8";

      div.innerHTML = `
        <h2 class="text-2xl font-bold text-indigo-700 mb-4">${r.filename}</h2>

        <h3 class="text-lg font-semibold mb-2">Top Keywords</h3>
        <div class="bg-black text-white p-4 rounded-lg">
          <ul class="space-y-1">
            ${r.keywords
              .map(k => `<li>${k.word} ‚Äî <span class="text-indigo-300">${k.score}</span></li>`).join("")}
          </ul>
        </div>

        <h3 class="text-lg font-semibold mt-6 mb-2">Summary</h3>
        <ul class="list-disc ml-6 space-y-1">
          ${r.summary.map(s => `<li>${s}</li>`).join("")}
        </ul>
      `;

      container.appendChild(div);
    });
  }
</script>

</body>
</html>
